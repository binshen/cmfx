<admintpl file="header" />
<body class="J_scroll_fixed">
	<div class="wrap J_check_wrap">
		<ul class="nav nav-tabs">
	     	<li class="active"><a href="{:U('AdminPayb/edit')}">应发详情（业务员）</a></li>
	  	</ul>
		<form class="form-horizontal J_ajaxForm" action="{:u('AdminPayb/edit_post')}" method="post">
		 	<table class="table table-hover table-bordered table-list">
          	<thead>
          		<tr>
	            	<th colspan="3"><span style="color:red;">{$name}--{$date}</span></th>
	            	<th>
	            	<php>
	            	if($status == 2) {
            			echo "<font color='green' style='float:right;'>已完结</font>";
            		} else {
            			echo "<font color='red' style='float:right;'>未完结</font>";
            		}
            		</php>
            		</th>
	          	</tr>
	          	<tr>
	            	<th>业务员</th>
	            	<th width="100">佣金</th>
	            	<th width="100">已付</th>
	            	<th width="100">本次实付</th>
	          	</tr>
	      	</thead>
	      	<foreach name="payb" item="vo">
        	<tr>
        		<td>{$vo.bname}({$vo.rname})<input type="hidden" name="id[]" value="{$vo.id}"></td>
        		<td><font color="green" size="3"><a href="javascript:;" onclick="c_bkg(this);">{$vo.bkg}</a></font></td>
        		<td><font color="red" size="3"><php>echo $vo['payd']?$vo['payd']:'0.00'</php></font></td>
        		<td><input type="text" name="pay[]" style="height:14px;"></td>
          	</tr>
          	</foreach>
		</table>
			<div class="form-actions">
				<button class="btn btn-primary" type="submit" onclick="return check_input();">提交</button>
				<a class="btn" href="{:U('AdminPayb/index')}">返回</a>
			</div>
		</form>
	</div>
	<script type="text/javascript" src="__ROOT__/statics/js/common.js"></script>
	<script>
		function check_input(){
			var err = 0;
			$("[name='pay[]']").each(function(){
				all = $(this).parent().prev().prev().find('font').html();
				payd = $(this).parent().prev().find('font').html();
				if(isNaN($(this).val())){
					var d = dialog({
					    align: 'bottom',
					    content: '请填写正确的数字!',
					    quickClose: true
					});
					d.show(this);
					err++;
					return false;
				}
				if(parseFloat($(this).val()) + parseFloat(payd) > parseFloat(all)){
					var d = dialog({
					    align: 'bottom',
					    content: '已付+本次付款不能大于应付',
					    quickClose: true
					});
					d.show(this);
					err++;
					return false;
				}
				

			});
			
			if(err > 0){
				return false;
			}
			
		}
		
		function c_bkg(obj){
			bkg = $(obj).html();
			$(obj).parent().parent().next().next().find('input').val(bkg);
		}
	</script>
</body>
</html>