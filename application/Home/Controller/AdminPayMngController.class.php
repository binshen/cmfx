<?phpnamespace Home\Controller;use Common\Controller\AdminbaseController;class AdminPayMngController extends AdminbaseController {        protected $Dao;    protected $BrokerDao;        function _initialize() {                parent::_initialize();        $this->Dao = D("Home/PayMng");        $this->BrokerDao = D("Home/Broker");    }        function index(){                $map = array();        if(IS_POST) {            $broker = I('post.broker');            if(!empty($broker)) {                $map['sid'] = $broker;            }                    $date = I('post.date');            if(!empty($date)) {                $map["DATE_FORMAT(sd_perf.date,'%Y%m')"] = $date;            }                    $this->assign('broker', $broker);            $this->assign('date', $date);        }                        $managerList = $this->Dao            ->join('sd_perf ON sd_perf.id = sd_pay_mng.pid')            ->join('sd_broker ON sd_broker.id = sd_pay_mng.sid')            ->join('sd_project ON sd_project.id = sd_perf.pid', 'left')            ->join('sd_store ON sd_store.manager_id = sd_pay_mng.sid', 'left')            ->field("sd_broker.name AS mname, DATE_FORMAT(sd_perf.date,'%Y-%m') AS date, sd_store.name AS sname, sd_store.loss, SUM(sd_pay_mng.bonus) AS bonus")            ->group("sd_broker.id, DATE_FORMAT(sd_perf.date,'%Y-%m')")            ->where($map)            ->select();                $this->assign('managerList', $managerList);                $brokerList = $this->BrokerDao->where('status=1 AND rank_id=6')->order('name')->select();        $this->assign('brokerList', $brokerList);                $this->display();    }}