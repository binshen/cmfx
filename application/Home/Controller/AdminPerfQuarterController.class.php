<?phpnamespace Home\Controller;use Common\Controller\AdminbaseController;class AdminPerfQuarterController extends AdminbaseController {        function _initialize() {        parent::_initialize();        $this->Daol = D("Home/PayLog");    }        function index($year=null,$quarter=null) {    	$yearList = array();    	for($i=0; $i<10; $i++) {    		$yearList[] = date("Y",strtotime("-$i year"));    	}    	    	$year = $year?$year:$_POST['year'];    	$quarter = $quarter?$quarter:$_POST['quarter'];		    	if($year){    		if($quarter == 1){    			$m = "'".$year."-01','".$year."-02','".$year."-03'";    			$q = $year."03";    		}    		if($quarter == 2){    			$m = "'".$year."-04','".$year."-05','".$year."-06'";    			$q = $year."06";    		}    		if($quarter == 3){    			$m = "'".$year."-07','".$year."-08','".$year."-09'";    			$q = $year."09";    		}    		if($quarter == 4){    			$m = "'".$year."-10','".$year."-11','".$year."-12'";    			$q = $year."12";    		}    		    		$sql = "SELECT						a.bid bid,						c.name bname,						sum(q_perf) q_perf,						sum(q_payd) q_payd,    					IFNULL(b.pay, 0) pay					FROM						sd_perf a					LEFT JOIN (						SELECT							bid,sum(pay) pay						FROM							sd_pay_log						WHERE							type = 3						AND date = '".$q."'						group by bid					) b ON a.bid = b.bid					left join sd_broker c on a.bid=c.id					WHERE						DATE_FORMAT(a.date, '%Y-%m') IN (".$m.")					group by a.bid";    		$Model = new \Think\Model();    		$perfQuarter = $Model->query($sql);    		$this->assign('perfQuarter', $perfQuarter);    	}    	     	$this->assign('q', $q);    	$this->assign('year', $year);    	$this->assign('quarter', $quarter);    	$this->assign('yearList', $yearList);        $this->display('AdminPerfQuarter:index');    }        function edit_post(){    	$bid_arr = $_POST['bid'];    	$pay_arr = $_POST['pay'];    	$date = $_POST['q'];    	$year = $_POST['year'];    	$quarter = $_POST['quarter'];    	foreach($bid_arr as $k=>$v){    		if($pay_arr[$k] > 0){    			$pay = $pay_arr[$k];    			$log = array(    					'bid'=>$bid_arr[$k],    					'date'=>$date,    					'pay'=>$pay,    					'created'=>date('Y-m-d H:i:s',time()),    					'type'=>3    			);    			$this->Daol->add($log);    	    		}    	}    	redirect("/Home/AdminPerfQuarter/index/year/".$year."/quarter/".$quarter);    }}