<?phpnamespace Home\Controller;use Common\Controller\AdminbaseController;class AdminReportController extends AdminbaseController {        protected $Dao;    protected $QuarterPerfDao;        function _initialize() {                parent::_initialize();        $this->Dao = D("Home/Perf");        $this->QuarterPerfDao =D("Home/QuarterPerf");    }        function index() {                $date = 2015;        $sql = "            SELECT            	sd_perf.date,            	sd_project.name AS p_name,            	sd_perf.num,            	sd_perf.total,            	sd_broker.name AS b_name,            	sd_store.name AS s_name,            	sd_rank.name AS r_name,            	sd_perf.perf,            	sd_perf.payd,                                sd_rank.id AS r_id,                sd_broker.id AS b_id            FROM sd_perf            LEFT JOIN sd_broker ON sd_broker.id = sd_perf.bid            LEFT JOIN sd_project ON sd_project.id = sd_perf.pid            LEFT JOIN sd_rank ON sd_rank.id = sd_broker.rank_id                        LEFT JOIN sd_store ON sd_store.manager_id = sd_broker.parent_id                        WHERE YEAR(sd_perf.date) = {$date}            ORDER BY sd_perf.date ASC            ";        $data = $this->Dao->query($sql);                $brokerQperf = array();        $Qperf = $this->QuarterPerfDao->where('year=' . $date)->select();        foreach ($Qperf as $p) {            $bid = $p['bid'];            $year = $p['year'];            $quarter = $p['quarter'];            $perf = $p['perf'];            if($brokerQperf[$bid]) $brokerQB[$bid] = array();            if($brokerQperf[$bid][$year]) $brokerQB[$bid][$year] = array();            $brokerQperf[$bid][$year][$quarter] = $perf;        }                foreach ($data as &$d) {            $rank_id = $d['r_id'];            $total = $d['perf'];            $d['bonus'] = getBrokerageByRank($rank_id, $total);                        $bid = $d['b_id'];            $date = $d['date'];            $year = date('Y', strtotime($date));            $quarter = ceil(date('m', strtotime($date)) / 3);            $month = date('m', strtotime($date));            if($month == 3 || $month == 6 || $month == 9 || $month == 12) {                $d['qperf'] = $brokerQperf[$bid][$year][$quarter];            }        }        dump($data);    }}